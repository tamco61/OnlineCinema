openapi: 3.1.0
info:
  description: Full-text search service for online cinema using Elasticsearch
  title: Search Service
  version: 1.0.0
servers:
- url: /
paths:
  /api/v1/search:
    get:
      description: |-
        Search for movies with full-text search and filters

        **Search fields:**
        - Title (boosted 3x)
        - Original title (boosted 2x)
        - Description
        - Actors (boosted 2x)
        - Directors (boosted 2x)

        **Filters:**
        - Genres (by slug)
        - Year range
        - Rating range
        - Age rating

        **Example:**
        ```
        GET /api/v1/search?query=inception&genres=sci-fi,action&year_from=2010&rating_from=8.0
        ```
      operationId: search_movies_api_v1_search_get
      parameters:
      - description: Search query
        explode: true
        in: query
        name: query
        required: false
        schema:
          nullable: true
          type: string
        style: form
      - description: "Comma-separated genre slugs (e.g., 'action,drama')"
        explode: true
        in: query
        name: genres
        required: false
        schema:
          nullable: true
          type: string
        style: form
      - description: Minimum year
        explode: true
        in: query
        name: year_from
        required: false
        schema:
          maximum: 2100
          minimum: 1900
          nullable: true
          type: integer
        style: form
      - description: Maximum year
        explode: true
        in: query
        name: year_to
        required: false
        schema:
          maximum: 2100
          minimum: 1900
          nullable: true
          type: integer
        style: form
      - description: Minimum rating
        explode: true
        in: query
        name: rating_from
        required: false
        schema:
          maximum: 10.0
          minimum: 0.0
          nullable: true
          type: number
        style: form
      - description: Maximum rating
        explode: true
        in: query
        name: rating_to
        required: false
        schema:
          maximum: 10.0
          minimum: 0.0
          nullable: true
          type: number
        style: form
      - description: "Comma-separated age ratings (e.g., 'PG,PG-13')"
        explode: true
        in: query
        name: age_rating
        required: false
        schema:
          nullable: true
          type: string
        style: form
      - description: Page number
        explode: true
        in: query
        name: page
        required: false
        schema:
          default: 1
          description: Page number
          minimum: 1
          title: Page
          type: integer
        style: form
      - description: Page size
        explode: true
        in: query
        name: size
        required: false
        schema:
          default: 20
          description: Page size
          maximum: 100
          minimum: 1
          title: Size
          type: integer
        style: form
      - description: Show only published movies
        explode: true
        in: query
        name: published_only
        required: false
        schema:
          default: true
          description: Show only published movies
          title: Published Only
          type: boolean
        style: form
      responses:
        "200":
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/SearchResponse"
          description: Successful Response
        "422":
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/HTTPValidationError"
          description: Validation Error
      summary: Search Movies
      tags:
      - Search
  /api/v1/search/suggest:
    get:
      description: |-
        Autocomplete suggestions for movie titles

        **Returns:**
        - Top matching movie titles
        - Sorted by relevance and rating

        **Example:**
        ```
        GET /api/v1/search/suggest?query=incep&limit=5
        ```
      operationId: autocomplete_movies_api_v1_search_suggest_get
      parameters:
      - description: Search query (minimum 2 characters)
        explode: true
        in: query
        name: query
        required: true
        schema:
          description: Search query (minimum 2 characters)
          minLength: 2
          title: Query
          type: string
        style: form
      - description: Maximum number of suggestions
        explode: true
        in: query
        name: limit
        required: false
        schema:
          default: 10
          description: Maximum number of suggestions
          maximum: 20
          minimum: 1
          title: Limit
          type: integer
        style: form
      responses:
        "200":
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/SuggestResponse"
          description: Successful Response
        "422":
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/HTTPValidationError"
          description: Validation Error
      summary: Autocomplete Movies
      tags:
      - Search
  /api/v1/search/health:
    get:
      description: |-
        Health check endpoint

        Verifies Elasticsearch connection
      operationId: health_check_api_v1_search_health_get
      responses:
        "200":
          content:
            application/json:
              schema: {}
          description: Successful Response
      summary: Health Check
      tags:
      - Search
  /:
    get:
      operationId: root__get
      responses:
        "200":
          content:
            application/json:
              schema: {}
          description: Successful Response
      summary: Root
  /health:
    get:
      description: Health check endpoint
      operationId: health_health_get
      responses:
        "200":
          content:
            application/json:
              schema: {}
          description: Successful Response
      summary: Health
components:
  schemas:
    DirectorInfo:
      example:
        full_name: full_name
        id: id
      properties:
        id:
          title: Id
          type: string
        full_name:
          title: Full Name
          type: string
      required:
      - full_name
      - id
      title: DirectorInfo
    GenreInfo:
      example:
        name: name
        id: id
        slug: slug
      properties:
        id:
          title: Id
          type: string
        name:
          title: Name
          type: string
        slug:
          title: Slug
          type: string
      required:
      - id
      - name
      - slug
      title: GenreInfo
    HTTPValidationError:
      example:
        detail:
        - msg: msg
          loc:
          - ValidationError_loc_inner
          - ValidationError_loc_inner
          type: type
        - msg: msg
          loc:
          - ValidationError_loc_inner
          - ValidationError_loc_inner
          type: type
      properties:
        detail:
          items:
            $ref: "#/components/schemas/ValidationError"
          title: detail
          type: array
      title: HTTPValidationError
    MovieSearchResult:
      example:
        original_title: original_title
        year: 0
        age_rating: age_rating
        is_published: false
        directors:
        - full_name: full_name
          id: id
        - full_name: full_name
          id: id
        rating: 1.4658129805029452
        description: description
        poster_url: poster_url
        movie_id: movie_id
        title: title
        trailer_url: trailer_url
        duration: 6
        actors:
        - full_name: full_name
          character_name: character_name
          id: id
        - full_name: full_name
          character_name: character_name
          id: id
        genres:
        - name: name
          id: id
          slug: slug
        - name: name
          id: id
          slug: slug
        published_at: 2000-01-23T04:56:07.000+00:00
      properties:
        movie_id:
          title: Movie Id
          type: string
        title:
          title: Title
          type: string
        original_title:
          nullable: true
          title: original_title
          type: string
        description:
          nullable: true
          title: description
          type: string
        year:
          title: Year
          type: integer
        duration:
          nullable: true
          title: duration
          type: integer
        rating:
          nullable: true
          title: rating
          type: number
        age_rating:
          nullable: true
          title: age_rating
          type: string
        poster_url:
          nullable: true
          title: poster_url
          type: string
        trailer_url:
          nullable: true
          title: trailer_url
          type: string
        genres:
          default: []
          items:
            $ref: "#/components/schemas/GenreInfo"
          title: genres
          type: array
        actors:
          default: []
          items:
            $ref: "#/components/schemas/PersonInfo"
          title: actors
          type: array
        directors:
          default: []
          items:
            $ref: "#/components/schemas/DirectorInfo"
          title: directors
          type: array
        is_published:
          default: false
          title: Is Published
          type: boolean
        published_at:
          format: date-time
          nullable: true
          title: published_at
          type: string
      required:
      - movie_id
      - title
      - year
      title: MovieSearchResult
    PersonInfo:
      example:
        full_name: full_name
        character_name: character_name
        id: id
      properties:
        id:
          title: Id
          type: string
        full_name:
          title: Full Name
          type: string
        character_name:
          nullable: true
          title: character_name
          type: string
      required:
      - full_name
      - id
      title: PersonInfo
    SearchResponse:
      example:
        total: 5
        size: 2
        page: 5
        total_pages: 7
        results:
        - original_title: original_title
          year: 0
          age_rating: age_rating
          is_published: false
          directors:
          - full_name: full_name
            id: id
          - full_name: full_name
            id: id
          rating: 1.4658129805029452
          description: description
          poster_url: poster_url
          movie_id: movie_id
          title: title
          trailer_url: trailer_url
          duration: 6
          actors:
          - full_name: full_name
            character_name: character_name
            id: id
          - full_name: full_name
            character_name: character_name
            id: id
          genres:
          - name: name
            id: id
            slug: slug
          - name: name
            id: id
            slug: slug
          published_at: 2000-01-23T04:56:07.000+00:00
        - original_title: original_title
          year: 0
          age_rating: age_rating
          is_published: false
          directors:
          - full_name: full_name
            id: id
          - full_name: full_name
            id: id
          rating: 1.4658129805029452
          description: description
          poster_url: poster_url
          movie_id: movie_id
          title: title
          trailer_url: trailer_url
          duration: 6
          actors:
          - full_name: full_name
            character_name: character_name
            id: id
          - full_name: full_name
            character_name: character_name
            id: id
          genres:
          - name: name
            id: id
            slug: slug
          - name: name
            id: id
            slug: slug
          published_at: 2000-01-23T04:56:07.000+00:00
      properties:
        results:
          items:
            $ref: "#/components/schemas/MovieSearchResult"
          title: results
          type: array
        total:
          title: Total
          type: integer
        page:
          title: Page
          type: integer
        size:
          title: Size
          type: integer
        total_pages:
          title: Total Pages
          type: integer
      required:
      - page
      - results
      - size
      - total
      - total_pages
      title: SearchResponse
    SuggestResponse:
      example:
        suggestions:
        - year: 0
          poster_url: poster_url
          movie_id: movie_id
          title: title
        - year: 0
          poster_url: poster_url
          movie_id: movie_id
          title: title
      properties:
        suggestions:
          items:
            $ref: "#/components/schemas/SuggestionItem"
          title: suggestions
          type: array
      required:
      - suggestions
      title: SuggestResponse
    SuggestionItem:
      example:
        year: 0
        poster_url: poster_url
        movie_id: movie_id
        title: title
      properties:
        movie_id:
          title: Movie Id
          type: string
        title:
          title: Title
          type: string
        year:
          title: Year
          type: integer
        poster_url:
          nullable: true
          title: poster_url
          type: string
      required:
      - movie_id
      - title
      - year
      title: SuggestionItem
    ValidationError:
      example:
        msg: msg
        loc:
        - ValidationError_loc_inner
        - ValidationError_loc_inner
        type: type
      properties:
        loc:
          items:
            $ref: "#/components/schemas/ValidationError_loc_inner"
          title: loc
          type: array
        msg:
          title: Message
          type: string
        type:
          title: Error Type
          type: string
      required:
      - loc
      - msg
      - type
      title: ValidationError
    ValidationError_loc_inner:
      anyOf:
      - type: string
      - type: integer
      title: ValidationError_loc_inner
